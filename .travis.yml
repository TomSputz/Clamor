language: python
sudo: false
cache: pip

python:
  - "3.5"
  - "3.6"

matrix:
  include:
    # Python 3.7 workaround
    - python: 3.7.3
      dist: xenial
      sudo: true

install:
  - pip install pylama
  - pip install -e .
  - pip install -U -r .readthedocs/requirements.txt

script:
  # Linting
  - pylama .

  # Unit tests
  - if [ "$TRAVIS_PULL_REQUEST" = "false" ]; then python setup.py test; fi

  # Build docs
  - make -C docs html

before_deploy:
  # Remove junk generated by setup.py test
  - rm -rf *.egg-info

deploy:
  provider: pypi
  user: $PYPI_DEPLOY_USER
  password: $PYPI_DEPLOY_PASSWORD
  skip_existing: true
  on:
    tags: true
